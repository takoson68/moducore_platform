import{c as $,r as w,a as g,o as D,b as c,d as l,e,f as m,n as R,t as _,w as O,g as E,v as M,h as T,F as P,i as x,j as S,k as L,l as N,m as V,u as U}from"./index-DiR3mkho.js";const I={class:"platform-login-panel"},A={class:"panel-status"},F={key:0,class:"status-text"},q={class:"panel-actions"},J={class:"login-anchor"},W=["disabled"],z=["disabled"],G={key:2,class:"login-popover"},H={class:"login-actions"},K=["disabled"],Q={key:0,class:"panel-message error"},X={key:1,class:"panel-message info"},Y={__name:"PlatformLoginPanel",setup(j){const h=$.resolve("auth"),p=$.resolve("token"),b=w("demo"),k=w("demo123"),i=w(!1),o=w(""),r=w(""),d=w(!1),u=g(()=>h.state.user),n=g(()=>h.isLoggedIn());async function s(y,a={}){const v=await fetch(y,{headers:{"Content-Type":"application/json",...a.headers||{}},...a}),B=await v.json().catch(()=>({}));return{ok:v.ok,status:v.status,data:B}}async function t(){i.value=!0,o.value="",r.value="";const{ok:y,data:a}=await s("/api/session");if(!y){o.value="Session 取得失敗",i.value=!1;return}a.authenticated&&a.user?(h.login(a.user),p.setToken(a.token||null),r.value="已恢復登入狀態"):(h.logout(),p.setToken(null)),i.value=!1}async function f(){if(i.value)return;i.value=!0,o.value="",r.value="";const y={username:b.value,password:k.value},{ok:a,data:v}=await s("/api/login",{method:"POST",body:JSON.stringify(y)});if(!a||v.success===!1){o.value=v.message||"登入失敗",i.value=!1;return}h.login(v.user),p.setToken(v.token||null),r.value="登入成功",d.value=!1,i.value=!1}async function C(){i.value||(i.value=!0,o.value="",r.value="",await s("/api/logout",{method:"POST"}),h.logout(),p.setToken(null),r.value="已登出",i.value=!1)}return D(()=>{t()}),(y,a)=>(l(),c("div",I,[e("div",A,[e("span",{class:R(["status-pill",{active:n.value}])},_(n.value?"已登入":"未登入"),3),u.value?(l(),c("span",F,_(u.value.name),1)):m("",!0)]),e("div",q,[e("div",J,[n.value?(l(),c("button",{key:1,class:"action-btn outline",type:"button",onClick:C,disabled:i.value},_(i.value?"登出中...":"登出"),9,z)):(l(),c("button",{key:0,class:"action-btn",type:"button",onClick:a[0]||(a[0]=v=>d.value=!d.value),disabled:i.value},"登入",8,W)),d.value&&!n.value?(l(),c("div",G,[a[5]||(a[5]=e("h3",{class:"login-title"},"平台登入",-1)),a[6]||(a[6]=e("p",{class:"login-subtitle"},"使用測試帳密進行登入（帳號 demo / 密碼 demo123）",-1)),e("form",{class:"login-form",onSubmit:O(f,["prevent"])},[E(e("input",{class:"input-field","onUpdate:modelValue":a[1]||(a[1]=v=>b.value=v),type:"text",autocomplete:"username",placeholder:"帳號"},null,512),[[M,b.value]]),E(e("input",{class:"input-field","onUpdate:modelValue":a[2]||(a[2]=v=>k.value=v),type:"password",autocomplete:"current-password",placeholder:"密碼"},null,512),[[M,k.value]]),e("div",H,[e("button",{class:"action-btn outline",type:"button",onClick:a[3]||(a[3]=v=>d.value=!1)},"關閉"),e("button",{class:"action-btn",type:"submit",disabled:i.value},_(i.value?"登入中...":"登入"),9,K)])],32),o.value?(l(),c("p",Q,_(o.value),1)):m("",!0)])):m("",!0)])]),d.value&&!n.value?(l(),c("div",{key:0,class:"login-overlay",onClick:a[4]||(a[4]=O(v=>d.value=!1,["self"]))})):m("",!0),r.value?(l(),c("p",X,_(r.value),1)):m("",!0)]))}},Z={class:"topbar"},ee={class:"brand"},te={class:"brand-title"},se={class:"brand-sub"},ae={key:0,class:"topbar-nav"},oe={key:0,class:"topbar-submenu"},ne={class:"topbar-actions"},le={__name:"ProjectTopbar",props:{projectConfig:Object},setup(j){const h=$.getService("resolveNavProjection"),p=g(()=>{const r=window.__MODULE_ROUTES__||{all:[]};return h(r.all||[])}),b=g(()=>{const r=new Map;(p.value.topbar||[]).forEach(t=>{!t?.path||r.has(t.path)||r.set(t.path,{...t,children:[]})});const d=[...r.values()],u=new Map(d.map(t=>[t.path,t])),n=[];d.forEach(t=>{const f=t.parent;f&&u.has(f)?u.get(f).children.push(t):n.push(t)});const s=(t,f)=>{const C=(t.order||0)-(f.order||0);return C!==0?C:String(t.label||"").localeCompare(String(f.label||""))};return d.forEach(t=>{t.children.sort(s)}),n.sort(s)}),k=$.resolve("lifecycle"),i=$.resolve("module"),o=g(()=>k.state.phase);return g(()=>i.state.modules.length),(r,d)=>{const u=T("RouterLink");return l(),c("header",Z,[e("div",ee,[e("div",te,_(j.projectConfig?.title??"Project"),1),e("div",se,"Guest World Establishment · "+_(o.value),1)]),b.value.length?(l(),c("nav",ae,[(l(!0),c(P,null,x(b.value,n=>(l(),c("div",{class:"topbar-item",key:n.path},[S(u,{class:"topbar-link",to:n.path,"active-class":"is-active","exact-active-class":"is-active"},{default:L(()=>[N(_(n.label),1)]),_:2},1032,["to"]),n.children&&n.children.length?(l(),c("div",oe,[(l(!0),c(P,null,x(n.children,s=>(l(),V(u,{class:"topbar-sub-link",key:s.path,to:s.path,"active-class":"is-active","exact-active-class":"is-active"},{default:L(()=>[N(_(s.label),1)]),_:2},1032,["to"]))),128))])):m("",!0)]))),128))])):m("",!0),e("div",ne,[S(Y)])])}}},re={class:"sidebar"},ce={class:"module-nav"},ie={class:"link-label"},ue={key:0,class:"submenu"},de={class:"link-label"},ve={__name:"ProjectSidebar",setup(j){const h=U(),p=$.getService("resolveNavProjection"),b=g(()=>{const o=window.__MODULE_ROUTES__||{all:[]};return p(o.all||[])}),k=g(()=>{const o=new Map,r=b.value.sidebar||[];r.forEach(s=>{o.set(s.path,{...s,children:[]})});const d=[];r.forEach(s=>{const t=s.parent;t&&o.has(t)?o.get(t).children.push(o.get(s.path)):d.push(o.get(s.path))});const u=(s,t)=>{const f=(s.order||0)-(t.order||0);return f!==0?f:String(s.label||"").localeCompare(String(t.label||""))},n=s=>({path:s.path,label:s.label,children:s.children.sort(u).map(n)});return d.sort(u).map(n)}),i=o=>o?.path?h.path===o.path?!0:Array.isArray(o.children)?o.children.some(r=>h.path===r.path):!1:!1;return(o,r)=>{const d=T("RouterLink");return l(),c("aside",re,[e("nav",ce,[(l(!0),c(P,null,x(k.value,u=>(l(),c("div",{class:R(["sidebar-item",{active:i(u)}]),key:u.path},[S(d,{class:"main-link",to:u.path,"active-class":"is-active","exact-active-class":"is-active"},{default:L(()=>[e("span",ie,_(u.label),1)]),_:2},1032,["to"]),u.children&&u.children.length?(l(),c("div",ue,[(l(!0),c(P,null,x(u.children,n=>(l(),V(d,{class:"sub-link",key:n.path,to:n.path,"active-class":"is-active","exact-active-class":"is-active"},{default:L(()=>[e("span",de,_(n.label),1)]),_:2},1032,["to"]))),128))])):m("",!0)],2))),128))])])}}},pe={class:"shell"},he={class:"main"},_e={class:"content"},fe={class:"module-shell"},be={class:"module-body"},me={__name:"RootShell",props:{projectConfig:Object,discoveredModules:Array},setup(j){return(h,p)=>{const b=T("RouterView");return l(),c("div",pe,[S(le,{"project-config":j.projectConfig},null,8,["project-config"]),e("div",he,[S(ve),e("section",_e,[p[0]||(p[0]=e("h2",null,"View",-1)),e("div",fe,[e("div",be,[S(b)])])])]),p[1]||(p[1]=e("footer",{class:"footer"},[e("span",null,"World Shell Footer")],-1))])}}};function ke(){return{id:"root-shell",component:me}}export{ke as defineLayout};
